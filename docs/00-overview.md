# Port Planner - Обзор проекта

## Документация

Проект разбит на следующие документы:

| # | Документ | Описание | Статус |
|---|----------|----------|--------|
| 00 | [Overview](00-overview.md) | Общий обзор, решения, roadmap | ✅ Согласован |
| 01 | [Architecture](01-architecture.md) | Структура проекта, технологии, data flow | В работе |
| 02 | [Planning Phase](02-planning-phase.md) | Фаза планирования: UI, drag-and-drop, валидация | В работе |
| 03 | [Simulation Phase](03-simulation-phase.md) | Движок симуляции, органы, правила | В работе |
| 04 | [Results Phase](04-results-phase.md) | Расчёт результатов, деградация, оценка (assessment) | ✅ Актуализирован |
| 05 | [Configuration](05-configuration.md) | Конфиги кораблей, органов, уровней, балансировка | В работе |
| 06 | [Data Models](06-data-models.md) | TypeScript интерфейсы и типы | В работе |

---

## Принятые решения

| Аспект | Решение | Обоснование |
|--------|---------|-------------|
| Платформа | Web (TypeScript + React) | Быстрое прототипирование, кроссплатформенность |
| State Management | Zustand | Простой API, встроенный persist, хорошая типизация |
| Rendering | SVG + CSS | Нативная интеграция с React, достаточно для прототипа |
| Persistence | LocalStorage | Через Zustand persist middleware |
| Assets | Placeholder (emoji) | Заменим на реальные ассеты позже |
| Dev Approach | Vertical slices | Быстрее получаем играбельный билд |
| **Config Format** | **JSON файлы** | Проще редактировать без знания TypeScript |

---

## Структура конфигов

```
data/
├── foods.json           # Все корабли с едой
├── interventions.json   # Все интервенции
├── organs.json          # Параметры органов (опционально)
└── levels/
    ├── level-01.json    # Первый уровень
    ├── level-02.json    # Второй уровень
    └── ...
```

### foods.json — Корабли еды
- ID
- Название
- Emoji (placeholder)
- Размер корабля (S/M/L)
- Углеводы (carbs, граммы) и глюкоза (glucose = carbs × 10)
- WP-стоимость (wpCost, 0-9)
- Клетчатка (fiber, boolean)

### interventions.json — Интервенции
- ID
- Название
- Картинка
- Размер корабля
- Количество вещества
- Целевой контейнер (metforminEffect / exerciseEffect)

### levels/level-XX.json — Уровни
- ID уровня
- Название
- Количество дней
- Список ID доступной еды (с количеством: `{ id, count }`)
- Список ID доступных интервенций
- **Лимиты углеводов по сегментам** (`segmentCarbs`: min/optimal/max на Morning/Day/Evening)
- **Бюджет WP** (`wpBudget`, по умолчанию 16)
- Конфиги по дням (`dayConfigs`) — переопределение на конкретный день
- Начальная деградация (если есть)
- **Начальный уровень сахара** (`initialBG`)
- **Предзанятые слоты** (`preOccupiedSlots`) — корабли, которые уже стоят и нельзя убрать/заменить

---

## Scope прототипа

### Включено:
- Полный игровой цикл: Planning → Simulation → Results
- 3 сегмента дня: Morning, Day, Evening
- Корабли еды (S, M, L размеры)
- 2 интервенции: Metformin, Exercise
- Органы: Liver, BG, Pancreas+Muscles (Kidneys исключены из прототипа)
- Система деградации (расчёт ТОЛЬКО в Results phase)
- Вмешательство игрока в симуляцию (boost)
- Сохранение прогресса
- **Перенос деградации между уровнями**
- **Willpower Points (WP)** — бюджет ресурсов для размещения еды (v0.16.0)
- **Segment Carb Limits** — лимиты углеводов по сегментам дня (v0.16.0)
- **Клетчатка (Fiber)** — замедление потока глюкозы (v0.12.0)
- **Eye Toggle** — скрытие/показ детальных индикаторов (v0.16.0)

### Отложено:
- SGLT2, GLP1, Insulin интервенции
- Орган Kidneys
- Туториал
- Звуки

### Удалено (v0.16.0):
- ~~Настроение (Mood)~~ — заменено на Willpower Points

---

## Ключевые правила

### Деградация
1. **Во время симуляции** — деградация НЕ применяется
2. **В Results** — рассчитывается на основе BG history
3. **Между днями одного уровня** — деградация накапливается
4. **Между уровнями** — деградация переносится (прогрессия болезни)

### Конфигурация уровней
1. Каждый уровень — отдельный JSON файл
2. В уровне указываются:
   - ID еды и интервенций из общих файлов
   - Количество дней
   - Занятые слоты (`preOccupiedSlots`)
   - Стартовый уровень сахара (`initialBG`)
   - Стартовые уровни деградации органов (если есть)
3. Уровни создаются вручную

---

## Roadmap (Vertical Slices)

### Slice 1: Минимальный цикл
- [ ] Инфраструктура проекта
- [ ] JSON конфиги (foods, interventions, 1 level)
- [ ] Полная сетка слотов (все 18: Morning, Day, Evening)
- [ ] 2-3 корабля еды
- [ ] Базовый движок:
  - Liver → BG transfer
  - Pancreas реагирует на BG level
  - Muscles активируются Pancreas
  - Перекачка и удаление глюкозы из BG
- [ ] Минимальный UI симуляции
- [ ] Простые результаты

### Slice 2: Полное планирование
- [ ] Все 3 сегмента
- [ ] Все размеры кораблей
- [ ] Inventory с вкладками (Food / Interventions)
- [ ] Валидация углеводов

### Slice 3: Полная симуляция
- [ ] Все органы и контейнеры (кроме Kidneys)
- [ ] Полная система правил
- [ ] Rate tiers

### Slice 4: Интервенции
- [ ] Effect Containers
- [ ] Metformin логика
- [ ] Exercise логика

### Slice 5: Вмешательство игрока
- [ ] Boost кнопки
- [ ] Заряды и кулдауны

### Slice 6: Деградация
- [ ] Degradation Containers
- [ ] Расчёт в Results phase
- [ ] Перенос между днями уровня
- [ ] Перенос между уровнями

### Slice 7: Polish
- [ ] Анимации
- [ ] Speed controls
- [ ] UX улучшения

### Slice 8: Многоуровневость
- [ ] Несколько уровней
- [ ] Прогрессия деградации
- [ ] Win/Lose условия

---

## Открытые вопросы

1. ~~Конфигурирование: JSON или TypeScript?~~ → **JSON**
2. Как именно балансировать параметры? → Вручную, тестированием
3. ~~Нужен ли редактор уровней?~~ → Нет, уровни вручную в JSON

---

## Следующий документ

→ [01-architecture.md](01-architecture.md) или [05-configuration.md](05-configuration.md)
